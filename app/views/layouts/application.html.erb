<!DOCTYPE html>
<html>
  <head>
    <title><%= content_for(:title) || "Music Shop" %></title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="application-name" content="Music Shop">
    <meta name="mobile-web-app-capable" content="yes">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= yield :head %>

    <%= stylesheet_link_tag :app, "data-turbo-track": "reload" %>
    <%= javascript_importmap_tags %>
  </head>

  <body class="vinyl-pattern">
    <nav class="retro-nav fixed top-0 inset-x-0 z-50">
      <div class="w-full px-6 py-4 flex justify-between items-center">
        
        <a href="/" class="retro-logo">
          ðŸŽµ Music Shop
        </a>

        <div class="flex gap-4">
          <% if logged_in? %>
            <span class="text-gray-300" style="padding: 0.5rem 1rem; display: flex; align-items: center;">
              Hola, <%= current_user.name %>
            </span>
            <%= link_to "Sign Out", logout_path, method: :delete, data: { turbo_method: :delete, turbo_confirm: "Â¿EstÃ¡s seguro que quieres cerrar sesiÃ³n?" }, class: "btn-neon-pink" %>
          <% else %>
            <%= link_to "Login", login_path, class: "btn-neon-pink" %>
          <% end %>
        </div>

      </div>
    </nav>

    <% if logged_in? %>
      <aside class="sidebar-nav">
        <div class="sidebar-content">
          <h3 class="sidebar-title">MenÃº</h3>
          <ul class="sidebar-menu">
            <li>
              <%= link_to "/profile", class: "sidebar-link" do %>
                ðŸ‘¤ <span>Mi Perfil</span>
              <% end %>
            </li>
            <li>
              <%= link_to products_path, class: "sidebar-link" do %>
                ðŸŽµ <span>Productos</span>
              <% end %>
            </li>
             <li>
              <%= link_to new_backstore_sale_path, class: "sidebar-link" do %>
                âž• <span>Nueva Venta</span>
              <% end %>
            </li>
            <li>
              <%= link_to backstore_sales_path, class: "sidebar-link" do %>
                ðŸ’° <span>Ventas</span>
              <% end %>
            </li>
            <li>
              <%= link_to backstore_reports_path, class: "sidebar-link" do %>
                ðŸ“Š <span>Reportes</span>
              <% end %>
            </li>
            
            <%# Solo mostrar GestiÃ³n de Usuarios si tiene el permiso modify_role %>
            <% if can?("modify_role") %>
              <li>
                <%= link_to users_list_path, class: "sidebar-link" do %>
                  ðŸ‘¥ <span>GestiÃ³n de Usuarios</span>
                <% end %>
              </li>
            <% end %>

          </ul>
        </div>
      </aside>
    <% end %>

    <main class="<%= logged_in? ? 'main-content-with-sidebar' : 'main-content' %> mx-auto mt-28 px-5 py-8" style="max-width: 1280px;">
      <% flash.each do |type, message| %>
        <div class="flash-message flash-<%= type %>">
          <%= message %>
        </div>
      <% end %>
      <%= yield %>
    </main>
  </body>
</html>
